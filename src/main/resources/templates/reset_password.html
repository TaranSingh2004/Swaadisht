<!DOCTYPE html>
<html
        lang="en"
        th:replace="~{base :: parent(~{::#content},~{::title},~{::script})}"
>
<head>
  <title>Home page</title>
</head>
<body>
<div id="content">
  <div role="main" class="w-full  max-w-md mx-auto p-6">
    <div class="mt-7 bg-white  rounded-xl shadow-lg dark:bg-gray-800 dark:border-gray-700 border-2 border-indigo-300">
      <div class="p-4 sm:p-7">
        <div class="text-center">
          <h1 class="block text-2xl font-bold text-gray-800 dark:text-white">Reset password?</h1>
          <th:block th:if="${session.succMsg}">
            <p class="text-success fw-bold text-center">[[${session.succMsg}]]</p>
            <th:block th:text="${@commonServiceImpl.removeSessionMessage()}"></th:block>
          </th:block>

          <th:block th:if="${session.errorMsg}">
            <p class="text-danger fw-bold text-center">[[${session.errorMsg}]]</p>
            <th:block th:text="${@commonServiceImpl.removeSessionMessage()}"></th:block>
          </th:block>

        </div>

        <div class="mt-5">
          <form th:action="@{/reset-password}" method="post" id="resetPassword" novalidate>
            <div class="grid gap-y-4">
              <div>
                <label class="block text-sm font-bold ml-1 mb-2 dark:text-white">New Password</label>
                <div class="relative p-3">
                  <input type="password" name="password" id="pass" class="py-3 px-4 block w-full border-2 border-gray-200 rounded-md text-sm focus:border-blue-500 focus:ring-blue-500 shadow-sm" required aria-describedby="email-error">
                </div>
                <label class="block text-sm font-bold ml-1 mb-2 dark:text-white">Confirm Password</label>
                <div class="relative p-3">
                  <input type="password" id="confirmPassword" name="confirmPassword" class="py-3 px-4 block w-full border-2 border-gray-200 rounded-md text-sm focus:border-blue-500 focus:ring-blue-500 shadow-sm" required aria-describedby="email-error">
                </div>
                <input type="hidden" name="token" th:value="${token}">
              </div>
              <button type="submit" class="py-3 px-4 inline-flex justify-center items-center gap-2 rounded-md border border-transparent font-semibold bg-blue-500 text-white hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all text-sm dark:focus:ring-offset-gray-800">Reset password</button>
            </div>
          </form>
        </div>
      </div>
    </div>

  </div>
</div>
<script th:inline="javascript">
  document.addEventListener('DOMContentLoaded', function() {
      const form = document.getElementById('resetPassword');

      form.addEventListener('submit', function(e) {
          // Reset previous error states
          clearErrors();

          // Validate all fields
          const isValidPassword = validatePassword();
          const isValidConfirmPassword = validateConfirmPassword();
          const passwordsMatch = checkPasswordMatch();

          // If any validation fails, prevent form submission
          if (!isValidPassword || !isValidConfirmPassword ||
              !passwordsMatch) {
              e.preventDefault();
          }
      });

      // Real-time validation for password match
      document.getElementById('pass').addEventListener('input', checkPasswordMatch);
      document.getElementById('confirmPassword').addEventListener('input', checkPasswordMatch);

      function validatePassword() {
          const passwordInput = document.getElementById('pass');
          const password = passwordInput.value;

          if (!password) {
              showError(passwordInput, 'Password is required');
              return false;
          }

          if (password.length < 8) {
              showError(passwordInput, 'Password must be at least 8 characters');
              return false;
          }

          return true;
      }

      function validateConfirmPassword() {
          const confirmInput = document.getElementById('confirmPassword');
          if (!confirmInput.value) {
              showError(confirmInput, 'Please confirm your password');
              return false;
          }
          return true;
      }

      function checkPasswordMatch() {
          const password = document.getElementById('pass').value;
          const confirmPassword = document.getElementById('confirmPassword').value;
          const confirmInput = document.getElementById('confirmPassword');

          if (password && confirmPassword && password !== confirmPassword) {
              showError(confirmInput, 'Passwords do not match');
              return false;
          } else {
              clearError(confirmInput);
              return true;
          }
      }

      function showError(inputElement, message) {
          const parentDiv = inputElement.closest('div');
          let errorElement = parentDiv.querySelector('.error-message');

          if (!errorElement) {
              errorElement = document.createElement('p');
              errorElement.className = 'error-message text-red-500 text-xs mt-1';
              parentDiv.appendChild(errorElement);
          }

          errorElement.textContent = message;
          inputElement.classList.add('border-red-500');
      }

      function clearError(inputElement) {
          const parentDiv = inputElement.closest('div');
          const errorElement = parentDiv.querySelector('.error-message');

          if (errorElement) {
              errorElement.remove();
          }

          inputElement.classList.remove('border-red-500');
      }

      function clearErrors() {
          document.querySelectorAll('.error-message').forEach(el => el.remove());
          document.querySelectorAll('.border-red-500').forEach(el => el.classList.remove('border-red-500'));
          const termsLabel = document.querySelector('label[for="terms"]');
          if (termsLabel) termsLabel.style.color = '';
      }
  });
</script>
</body>
</html>