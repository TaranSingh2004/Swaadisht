<!DOCTYPE html>
<html lang="en" th:replace="~{base :: parent(~{::#content},~{::title},~{::script})}">
<head>
    <title>My Orders</title>
</head>
<body>
<div id="content">
    <a href="/admin" class="text-decoration-none"><i class="fa-solid fa-arrow-left"></i> Back to cart</a>

    <!-- Search Form -->
    <form th:action="@{/admin/search-order}" method="get" class="relative max-w-sm mx-auto mt-20">
        <input class="w-full py-2 px-4 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
               type="search" name="orderId" placeholder="Search Order ID" required>
        <button type="submit" class="absolute inset-y-0 right-0 flex items-center px-4 text-gray-700 bg-gray-100 border border-gray-300 rounded-r-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M14.795 13.408l5.204 5.204a1 1 0 01-1.414 1.414l-5.204-5.204a7.5 7.5 0 111.414-1.414zM8.5 14A5.5 5.5 0 103 8.5 5.506 5.506 0 008.5 14z" />
            </svg>
        </button>
    </form>

    <!-- Orders Table -->
    <div class="pl-8px relative overflow-x-auto shadow-md sm:rounded-lg" >
        <table class="min-w-full w-full divide-y divide-gray-200 overflow-x-auto border ml-20px">
            <thead class="bg-gray-50">
            <tr>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Order Id
                </th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Order Date
                </th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    User Details
                </th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Product Details
                </th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Price
                </th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Order Status
                </th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Payment Status
                </th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Actions
                </th>
            </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
            <!-- Search Results -->
            <th:block th:if="${srch}">
                <tr th:if="${orderDtls != null}">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">[[${orderDtls.orderId}]]</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">[[${#temporals.format(orderDtls.orderDate, 'dd-MM-yyyy')}]]</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">
                            Name: [[${orderDtls.user.name}]]
                            <br>Email: [[${orderDtls.user.email}]]
                            <br>Phone: [[${orderDtls.user.phoneNumber}]]
                            <br>Address: [[${orderDtls.orderAddress.address}]]
                            <br>City: [[${orderDtls.orderAddress.city}]]
                            <br>State: [[${orderDtls.orderAddress.state}]]
                            <br>Pincode: [[${orderDtls.orderAddress.pincode}]]
                        </div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="flex flex-col gap-2">
                            <div th:each="item : ${orderDtls.orderItems}" class="ml-1 px-1 py-0.5 text-xm rounded bg-pink-100 text-pink-800">
                                <div class="font-medium">[[${item.product.name}]]</div>
                                <div th:if="${item.customised}" class="text-sm text-gray-600">
                                    <div th:if="${not #lists.isEmpty(item.selectedIngredients)}">
                                        <span class="font-semibold">Ingredients:</span>
                                        <span th:each="ingredient : ${item.selectedIngredients}"
                                              class="ml-1 px-1 py-0.5 text-xs rounded bg-blue-100 text-blue-800">
                                               [[${ingredient.name}]]
                                            </span>
                                    </div>
                                    <div th:if="${not #lists.isEmpty(item.selectedToppings)}">
                                        <span class="font-semibold">Toppings:</span>
                                        <span th:each="topping : ${item.selectedToppings}"
                                              class="ml-1 px-1 py-0.5 text-xs rounded bg-green-100 text-green-800">
                                                [[${topping.name}]]
                                            </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex flex-col gap-2">
                            <div th:each="item : ${orderDtls.orderItems}">
                                <div class="text-sm">
                                    [[${item.quantity}]] x [[${#numbers.formatCurrency(item.unitPrice)}]]
                                    <span th:if="${item.selectedSize != null}">
                                          ([[${item.selectedSize.name}]])
                                        </span>
                                </div>
                            </div>
                            <div class="font-medium">
                                Total: [[${#numbers.formatCurrency(orderDtls.totalPrice)}]]
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                          <span th:switch="${orderDtls.status}" class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full">
                            <span th:case="'PENDING'" class="bg-yellow-100 text-yellow-800">[[${orderDtls.status}]]</span>
                            <span th:case="'COMPLETED'" class="bg-green-100 text-green-800">[[${orderDtls.status}]]</span>
                            <span th:case="'CANCELLED'" class="bg-red-100 text-red-800">[[${orderDtls.status}]]</span>
                            <span th:case="*" class="bg-gray-100 text-gray-800">[[${orderDtls.status}]]</span>
                          </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                          <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full">
                            <span th:switch="${orderDtls.paymentType}">
                              <span th:case="'PAID'" class="bg-green-100 text-green-800">[[${orderDtls.paymentType}]]</span>
                              <span th:case="*" class="bg-gray-100 text-gray-800">[[${orderDtls.paymentType}]]</span>
                            </span>
                          </span>
                    </td>
                    <td>
                        <form action="/admin/update-order-status" method="post">
                            <div class="row">
                                <div class="col">
                                    <select class="form-control" name="st" required>
                                        <option>--select--</option>
                                        <option value="1">In Progress</option>
                                        <option value="2">Order recieved</option>
                                        <option value="3">Product Packed</option>
                                        <option value="4">Out for Delivery</option>
                                        <option value="5">Delivered</option>
                                        <option value="6">Cancelled</option>
                                    </select>
                                </div>
                                <input th:value="${orderDtls.id}" name="id" type="hidden">
                                <div class="col">
                                    <th:block th:if="${orderDtls.status=='Cancelled' || orderDtls.status=='Delivered'}">
                                        <button class="btn btn-sm btn-primary col disabled">Update</button>
                                    </th:block>
                                    <th:block th:unless="${orderDtls.status=='Cancelled' || orderDtls.status=='Delivered'}">
                                        <button class="btn btn-sm btn-primary col">Update</button>
                                    </th:block>

                                </div>
                            </div>
                        </form>
                    </td>
                </tr>
                <tr th:if="${orderDtls == null}">
                    <td colspan="8" class="px-6 py-4 text-center">
                        <p class="fs-3 text-center text-danger">[[${errorMsg}]]</p>
                    </td>
                </tr>
            </th:block>

            <!-- Paginated Results -->
            <th:block th:unless="${srch}">
                <tr th:each="order : ${orders}">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">[[${order.orderId}]]</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">[[${#temporals.format(order.orderDate, 'dd-MM-yyyy')}]]</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">
                            Name: [[${order.user.name}]]
                            <br>Email: [[${order.user.email}]]
                            <br>Phone: [[${order.user.phoneNumber}]]
                            <br>Address: [[${order.orderAddress.address}]]
                            <br>City: [[${order.orderAddress.city}]]
                            <br>State: [[${order.orderAddress.state}]]
                            <br>Pincode: [[${order.orderAddress.pincode}]]
                        </div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="flex flex-col gap-2">
                            <div th:each="item : ${order.orderItems}" class="ml-1 px-1 py-0.5 text-xm rounded bg-pink-100 text-pink-800">
                                <div class="font-medium">[[${item.product.name}]]</div>
                                <div th:if="${item.customised}" class="text-sm text-gray-600">
                                    <div th:if="${not #lists.isEmpty(item.selectedIngredients)}">
                                        <span class="font-semibold">Ingredients:</span>
                                        <span th:each="ingredient : ${item.selectedIngredients}"
                                              class="ml-1 px-1 py-0.5 text-xs rounded bg-blue-100 text-blue-800">
                                               [[${ingredient.name}]]
                                            </span>
                                    </div>
                                    <div th:if="${not #lists.isEmpty(item.selectedToppings)}">
                                        <span class="font-semibold">Toppings:</span>
                                        <span th:each="topping : ${item.selectedToppings}"
                                              class="ml-1 px-1 py-0.5 text-xs rounded bg-green-100 text-green-800">
                                                [[${topping.name}]]
                                            </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="font-medium">
                            Total: [[${#numbers.formatCurrency(order.totalPrice)}]]
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                          <span th:switch="${order.status}" class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full">
                            <span th:case="'PENDING'" class="bg-yellow-100 text-yellow-800">[[${order.status}]]</span>
                            <span th:case="'COMPLETED'" class="bg-green-100 text-green-800">[[${order.status}]]</span>
                            <span th:case="'CANCELLED'" class="bg-red-100 text-red-800">[[${order.status}]]</span>
                            <span th:case="*" class="bg-gray-100 text-gray-800">[[${order.status}]]</span>
                          </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                          <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full">
                            <span th:switch="${order.paymentType}">
                              <span th:case="'PAID'" class="bg-green-100 text-green-800">[[${order.paymentType}]]</span>
                              <span th:case="*" class="bg-gray-100 text-gray-800">[[${order.paymentType}]]</span>
                            </span>
                          </span>
                    </td>
<!--                    <td>-->
<!--                        <form action="/admin/update-order-status" method="post">-->
<!--                            <div class="row">-->
<!--                                <div class="col">-->
<!--                                    <select class="form-control" name="st" required>-->
<!--                                        <option>&#45;&#45;select&#45;&#45;</option>-->
<!--                                        <option value="1">In Progress</option>-->
<!--                                        <option value="2">Order recieved</option>-->
<!--                                        <option value="3">Product Packed</option>-->
<!--                                        <option value="4">Out for Delivery</option>-->
<!--                                        <option value="5">Delivered</option>-->
<!--                                        <option value="6">Cancelled</option>-->
<!--                                    </select>-->
<!--                                </div>-->
<!--                                <input th:value="${order.id}" name="id" type="hidden">-->
<!--                                <div class="col">-->
<!--                                    <th:block th:if="${order.status=='Cancelled' || order.status=='Delivered'}">-->
<!--                                        <button class="btn btn-sm btn-primary col disabled">Update</button>-->
<!--                                    </th:block>-->
<!--                                    <th:block th:unless="${order.status=='Cancelled' || order.status=='Delivered'}">-->
<!--                                        <button class="btn btn-sm btn-primary col">Update</button>-->
<!--                                    </th:block>-->

<!--                                </div>-->
<!--                            </div>-->
<!--                        </form>-->
<!--                    </td>-->
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <form action="/admin/update-order-status" method="post" class="flex items-center">
                            <input type="hidden" name="id" th:value="${order.id}">
                            <select name="st"
                                    onchange="this.form.submit()"
                                    class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-white px-3 py-2 text-sm">
                                <option value="1" th:selected="${order.status == 'In Progress'}">In Progress</option>
                                <option value="2" th:selected="${order.status == 'Order recieved'}">Order Received</option>
                                <option value="3" th:selected="${order.status == 'Product Packed'}">Product Packed</option>
                                <option value="4" th:selected="${order.status == 'Out for Delivery'}">Out for Delivery</option>
                                <option value="5" th:selected="${order.status == 'Delivered'}">Delivered</option>
                                <option value="6" th:selected="${order.status == 'Cancelled'}">Cancelled</option>
                            </select>
                            <button type="submit" class="ml-2 hidden">Update</button>
                        </form>
                    </td>
                </tr>
            </th:block>
            </tbody>
        </table>

        <!-- Pagination -->
        <th:block th:if="${!srch}">
            <div class="container mx-auto px-4 mt-4 pb-4">
                <nav class="flex flex-row flex-nowrap justify-between md:justify-center items-center" aria-label="Pagination">
                    <!-- Previous Page -->
<!--                    <a th:classappend="${isFirst} ? 'opacity-50 cursor-not-allowed' : ''"-->
<!--                       class="flex w-10 h-10 mr-1 justify-center items-center rounded-full border border-gray-200 bg-white text-black hover:border-gray-300"-->
<!--                       th:href="@{'/admin/orders?pageNo=' + ${pageNo-1}}" title="Previous Page">-->
<!--                        <span class="sr-only">Previous Page</span>-->
<!--                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"-->
<!--                             stroke="currentColor" class="block w-5 h-5">-->
<!--                            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />-->
<!--                        </svg>-->
<!--                    </a>-->

                    <!-- Page Numbers -->
                    <div th:each="i:${#numbers.sequence(1, totalPages)}">
                        <a th:classappend="${pageNo+1 == i} ? 'bg-blue-500 text-white active' : 'bg-white text-black'"
                           class="hidden md:flex w-10 h-10 mx-1 justify-center items-center rounded-full border border-gray-200 hover:border-gray-300"
                           th:href="@{'/admin/orders?pageNo='+${i-1}}">
                            [[${i}]]
                        </a>
                    </div>

                    <!-- Next Page -->
<!--                    <a th:classappend="${isLast} ? 'opacity-50 cursor-not-allowed' : ''"-->
<!--                       class="flex w-10 h-10 ml-1 justify-center items-center rounded-full border border-gray-200 bg-white text-black hover:border-gray-300"-->
<!--                       th:href="@{'/admin/orders?pageNo=' + ${pageNo+1}}" title="Next Page">-->
<!--                        <span class="sr-only">Next Page</span>-->
<!--                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"-->
<!--                             stroke="currentColor" class="block w-5 h-5">-->
<!--                            <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />-->
<!--                        </svg>-->
<!--                    </a>-->
                </nav>
            </div>
        </th:block>
    </div>
</div>
<script>
    console.log("orders page");
</script>
</body>
</html>